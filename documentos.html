<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <title>Documentos</title>
</head>

<body>
    <div class="card-group">
        <div class="card">
            <h5 class="card-title" style="text-align: center;">RG</h5>
            <hr>
            <div class="card-body">
                <img src="img/icon-carteira-de-identidade.png" style="width: 200px; margin-left: 50%; transform: translateX(-50%);" class="card-img-top" alt="...">
                <p class="card-text">Cédula de Identidade ou RNE para estrangeiros (CNH não é válida)</p>
                    <p id="situacao"></p>
                    <input type="file" style="margin-left: 50%; transform: translateX(-50%);" id="documentoRg"></input>
                    <button type="submit" onclick="uploadRG()">Enviar</button>
            </div>
        </div>
        <div class="card">
            <h5 class="card-title" style="text-align: center;">Recibos/Comprovantes</h5>
            <hr>
            <div class="card-body">
                <img src="img/icon-comprovante.png" style="width: 200px; margin-left: 50%; transform: translateX(-50%);" class="card-img-top" alt="...">
                <p class="card-text">asdasd</p>
                    <p id="situacao"></p>
                    <input type="file" style="margin-left: 50%; transform: translateX(-50%);" id="documentoRecibo"></input>
                    <button type="submit" id="btnEnviarRG" onclick="chamar()">Enviar</button>
            </div>
        </div>
        
    </div>
    <script type="module" src="auth.js">
      import {verificarSessao} from './auth.js'
      verificarSessao()
    </script>   
    <script>
        const SUPABASE_URL = "https://zyyrmedbihwyxmhgudvz.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp5eXJtZWRiaWh3eXhtaGd1ZHZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU5ODYxMjgsImV4cCI6MjA3MTU2MjEyOH0.RZnBj4wjNbE3BsX15HW_hQZPncJp21Ns_3S29proWnA";
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        async function uploadRG() {
            const fileInput = document.getElementById('documentoRg');
            if (!fileInput.files.length) {
                alert("Selecione um arquivo!");
                return;
            }

            const file = fileInput.files[0];

            // pega o usuário logado
            const { data: { user }, error: userError } = await supabase.auth.getUser();
            if (!user) {
                alert("Usuário não autenticado");
                return;
            }

            // caminho do arquivo: rg/<user.id>/<nome-do-arquivo>
            const filePath = `${user.id}/${file.name}`;

            const { data, error } = await supabase.storage
                .from("rg")
                .upload(filePath, file, { cacheControl: "3600", upsert: true });

            if (error) {
                console.error("Erro no upload:", error.message);
                alert("Erro ao enviar arquivo");
                return;
            }

            console.log("Arquivo enviado:", data.path);
            alert("Upload realizado com sucesso!");
        }

   
    </script>
</body>

</html>